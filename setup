#!/bin/sh

# shellcheck source=./components/common.sh
. "$(dirname "$0")/components/common.sh" || exit 1

export HOMEBREW_PREFIX=${HOMEBREW_PREFIX:-~/.brew}
PATH="$HOMEBREW_PREFIX/bin:$(dirname "$0")/scripts:$PATH"

## Install CLI apps

# Install brew
if ! [ -e "$HOMEBREW_PREFIX/bin/brew" ]; then
    install-brew -s "$HOMEBREW_PREFIX"
fi

# Install languages
# shellcheck source=./scripts/install-asdf
. "$(dirname "$0")/scripts/install-asdf" || exit 1

# shellcheck source=./scripts/install-langs-asdf
"$(dirname "$0")/scripts/install-langs-asdf"

# Mac-specific
if is_mac; then
    brew install trash

    # Install GNU alternatives to mac/BSD tools
    brew install coreutils
    brew install gnu-sed
    brew install gawk
    brew install findutils
fi

# Install core
brew install git
brew install neovim
brew install tmux
brew install zsh

if is_mac; then
    brew install wget
fi

# Install development / build packages
brew install autoconf
brew install automake
brew install cmake
brew install gettext
brew install libtool
brew install ninja
brew install pandoc
brew install patchutils
brew install pkg-config

# Install tools
brew install fd
brew install ripgrep
brew install fzf
brew install exa
brew install git-delta
brew install direnv
brew install shfmt
install-shellcheck
brew install jq
brew install pup

pipx install flake8
pipx inject flake8 pep8-naming flake8-docstrings
pipx install httpie
pipx install peru
pipx install git-revise
pipx install git+https://github.com/kergoth/git-imerge@no-completions-in-setup

cargo install --git https://github.com/jez/as-tree
go install github.com/shurcooL/markdownfmt@latest

## Install GUI apps
if is_mac; then
    # Core
    brew install --cask appcleaner alfred carbon-copy-cloner syncthing the-unarchiver

    # Communication
    brew install --cask discord

    # Screen savers
    brew install --cask aerial brooklyn

    # Media
    brew install --cask vlc

    # Quicklook
    brew install --cask qlcolorcode qlmarkdown qlprettypatch qlstephen quicklook-csv quicklook-json webpquicklook

    # Productivity
    brew install --cask omnioutliner

    # Utilities
    brew install --cask keepingyouawake soulver2 daisydisk

    # Development
    brew install --cask visual-studio-code
fi

## Configuration
if is_mac; then
    # shellcheck source=./Components/macos-configure.sh
    "$(dirname "$0")/Components/macos-configure.sh"
fi
